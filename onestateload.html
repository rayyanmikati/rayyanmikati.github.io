---
layout: default
---

  <svg></svg>

<script src="https://d3js.org/topojson.v2.min.js"></script>
<script>

// path:hover {
//   fill-opacity: .7;
// }

var div = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

  var width = 900, height = 500;

  var svg = d3.select("svg")
    .attr("width", width)
    .attr("height", height);

  d3.json("../states.json", function(error, data){

    // converts Topojson to GeoJSON
    console.log(data);
    // make sure to use the right key in data.objects!
     //var featureCollection = data; // Jana use this one!
    var featureCollection = topojson.feature(data, data.objects.states);

    //console.log(featureCollection);


    // initializes a map projection
    // projection types: https://github.com/d3/d3-geo#azimuthal-projections
     var proj = d3.geoAlbersUsa() // Rayyan use this one!
      .fitSize([width, height], featureCollection);

    // creates a path generator
    var path = d3.geoPath()
      .projection(proj);

    var states = svg.selectAll("path")
      .data(featureCollection.features);

    // country codes: https://en.wikipedia.org/wiki/ISO_3166-1_numeric
    states.enter().append("path")
      .attr("d", path)
      .attr("stroke", "#e6e6ff")
      .attr("stroke-width", 1)
      .attr("fill", "#01DCC1")
      .on("mousemove", function(d) {
            div.transition()
                .duration(200)
                .style("opacity", .9);
            div.text(d.SpeciesTotal)
            .style("left", (d3.event.pageX) + "px")
            .style("top", (d3.event.pageY - 28) + "px");
            // div .html(formatTime(d.date) + "<br/>"  + d.close)
            //     .style("left", (d3.event.pageX) + "px")
            //     .style("top", (d3.event.pageY - 28) + "px");
            })
        .on("mouseout", function(d) {
            div.transition()
                .duration(500)
                .style("opacity", 0);
        });
      //   function(d){
      //   return d.id == "076" ? "green" : "#ccc";
      // }
      // )


    // coordinate points are reversed! ex. [longitude, latitude]
    // var points = [
    //   {"name": "Boston", "coords": [-71.0589, 42.3601]},
    // ];

    // var points = svg.selectAll("circle")
    //   .data(points);
    //
    // points.enter().append("circle")
    //   .attr("transform", function(d){
    //     return "translate(" + proj(d.coords) + ")";
    //   })
    //   .attr("fill", "red")
    //   .attr("r", 10);

  });


d3.queue()//No data for Hawaii
    .defer(d3.csv, "SpeciesList.csv")
    .defer(d3.csv, "alabama.csv")
    .defer(d3.csv, "Alaska.csv")
    .defer(d3.csv, "arizona.csv")
    .defer(d3.csv, "arkansas.csv")
    .defer(d3.csv, "california.csv")
    .defer(d3.csv, "colorado.csv")
    .defer(d3.csv, "connecticut.csv")
    .defer(d3.csv, "delaware.csv")
    .defer(d3.csv, "florida.csv")
    .defer(d3.csv, "georgia.csv")
    .defer(d3.csv, "idaho.csv")
    .defer(d3.csv, "illinois.csv")
    .defer(d3.csv, "indiana.csv")
    .defer(d3.csv, "iowa.csv")
    .defer(d3.csv, "kansas.csv")
    .defer(d3.csv, "kentucky.csv")
    .defer(d3.csv, "louisiana.csv")
    .defer(d3.csv, "maine.csv")
    .defer(d3.csv, "maryland.csv")
    .defer(d3.csv, "massachusetts.csv")
    .defer(d3.csv, "michigan.csv")
    .defer(d3.csv, "Minneso.csv")
    .defer(d3.csv, "mississippi.csv")
    .defer(d3.csv, "missouri.csv")
    .defer(d3.csv, "montana.csv")
    .defer(d3.csv, "nebraska.csv")
    .defer(d3.csv, "nevada.csv")
    .defer(d3.csv, "newhampshire.csv")
    .defer(d3.csv, "newjersey.csv")
    .defer(d3.csv, "newmexico.csv")
    .defer(d3.csv, "newyork.csv")
    .defer(d3.csv, "northcarolina.csv")
    .defer(d3.csv, "northdakota.csv")
    .defer(d3.csv, "ohio.csv")
    .defer(d3.csv, "oklahoma.csv")
    .defer(d3.csv, "oregon.csv")
    .defer(d3.csv, "pennsylvania.csv")
    .defer(d3.csv, "rhodeisland.csv")
    .defer(d3.csv, "southcarolina.csv")
    .defer(d3.csv, "southdakota.csv")
    .defer(d3.csv, "tennessee.csv")
    .defer(d3.csv, "texas.csv")
    .defer(d3.csv, "utah.csv")
    .defer(d3.csv, "vermont.csv")
    .defer(d3.csv, "virginia.csv")
    .defer(d3.csv, "washington.csv")
    .defer(d3.csv, "westvirginia.csv")
    .defer(d3.csv, "wisconsin.csv")
    .defer(d3.csv, "wyoming.csv")




    // .defer, d3.csv("arkansas.csv");
///.defer(d3.request, "http://www.google.com:81")
    .awaitAll(function(error, results) {
      if (error) throw error;
      console.log(results);
    results.forEach(function(data, i) {
      if (i != 0) {
        data.forEach(function(d) {
          d.SpeciesTotal = +d.SpeciesTotal;
          d.Year = +d.Year;
        })}

        results = data.filter(function(d, i) {
          return d.Aou = "1770";

        });

        var path2name = {
          "04000US48":"83",
          "04000US42":"72",
          "04000US45":"80",
          "04000US33":"58",
          // "04000US15":"Hawaii",
          "04000US16":"33",
          "04000US30":"53",
          "04000US35":"60",
          "04000US36":"61",
          "04000US38":"64",
          "04000US41":"69",
          "04000US26":"49",
          "04000US39":"66",
          "04000US13":"27",
          "04000US08":"17",
          "04000US12":"25",
          "04000US24":"46",
          "04000US50":"87",
          "04000US53":"89",
          "04000US04":"6",
          "04000US18":"35",
          "04000US19":"36",
          "04000US20":"38",
          "04000US21":"39",
          "04000US22":"42",
          "04000US23":"44",
          "04000US27":"50",
          "04000US29":"52",
          "04000US31":"54",
          "04000US44":"77",
          "04000US47":"82",
          "04000US51":"88",
          "04000US55":"91",
          "04000US56":"92",
          // "04000US72":"Puerto Rico",
          "04000US40":"67",
          "04000US02":"3",
          "04000US10":"21",
          "04000US32":"55",
          "04000US05":"7",
          "04000US17":"34",
          "04000US06":"14",
          // "04000US11":"District of Columbia",
          "04000US09":"18",
          "04000US37":"63",
          "04000US25":"47",
          "04000US54":"90",
          "04000US49":"85",
          "04000US01":"2",
          "04000US46":"81",
          "04000US28":"51",
          "04000US34":"59"
        };
        var nestedState = d3.nest()
            .key(function(d, i) {
              return d.statenum;
            })
            .entries(results);
          nestedState.forEach(function(d) {
            d.SpeciesTotal = d3.sum(d.values, function(x, i){
              return x.SpeciesTotal;
            })
            console.log(d.key, d.SpeciesTotal)
            })
        // var svg = d3.select("body").append("svg")
        //       .attr("width", 1500)
        //       .attr("height", 1000);

        // var draw = function(results) {
        //
        //     var svg = d3.select("svg");
        //
        //     var circles = svg.selectAll("circle").data(results);
        //
        //
        //     var dataExtent = d3.extent(results, function(d, i) {
        //         return d.SpeciesTotal;
        //       });
        //
        //         console.log(dataExtent);
        //
        //
        //     var radius = d3.scaleLinear()
        //       .domain(dataExtent)
        //       .range([5, 50]);
        //
        //
        //     circles.enter().append("circle")
        //     .transition()
        //     .duration(2000)
        //       .attr("fill", "#FF239E")
        //
        //       .attr("cy", function(d, i) {
        //         return 200 + (100 * Math.floor(i/10))
        //       })
        //       .attr("cx", function(d, i) {
        //         return 60 + (120 * (i % 10))
        //       })
        //       .attr("r", function(d, i) {
        //         return radius(d.SpeciesTotal)
        //       });
        //
        //     };

        var nestedYear = d3.nest()
            .key(function(d, i) {
              return d.Year;
              // return d.Year, d.statenum;//this didn't work but why?
            })
            .entries(results);
          nestedYear.forEach(function(d) {
            d.SpeciesTotal = d3.sum(d.values, function(x, i) {
              return x.SpeciesTotal;
            })
            console.log(d.key, d.SpeciesTotal)
          })
          // draw(nestedYear);

});

});


</script>
